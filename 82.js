//https://www.lpc.ms.gov/secure/licensesearch.asp
var header_val = ['full_name','address1','address2','city','state','zip','county','phone','email','plpc_license_number','plpc_issue_date','plpc_expiration_date','lpc_license_number','lpc_issue_date','lpc_renewal_date','status','supervisor?','bqs_cert_date','bqs_cert_num','telehealth_cert?']; var header_sel = document.querySelector('table > tbody > tr > td > font > b > table > tbody > tr:first-child'); for (i=0;i<header_val.length;i++) { 	header_sel.insertCell(-1).textContent = header_val[i]; };
var rows = document.querySelectorAll('table > tbody > tr > td > font > b > table > tbody > tr:not(:first-child)');
if (rows[0].textContent.trim() == 'No Counselor(s) Found with the above criteria') {
    for (z=0;z<(header_val.length+5);z++) {
        rows[0].insertCell(-1).textContent = 'redacted';
    }
} else {
    for (i=0;i<rows.length;i++){ 	var detailsLink = rows[i].querySelector('a');request = new XMLHttpRequest(); 	request.open('GET', detailsLink.href, false); 	request.send(null); 	var detailsPage = new DOMParser().parseFromString(request.responseText,'text/html'); 	var values = detailsPage.querySelector('table > tbody > tr:nth-of-type(3) > td:nth-of-type(3) > table > tbody > tr > td').textContent.replace(/^\s*[\r\n]?/gm, '').split('\n'); 	values.shift(); 	values.shift(); 	for (j=8;j<values.length-1;j++){ 		if(values[j].match(/:\s*$/) && !values[j+1].includes(":")){ 			values[j]=values[j].concat(" ",values[j+1]); 			values[j] = values[j].replace(/\s+/g,' '); 		} 	} 	var full_name = values[0]; 	var address1 = values[1]; 	var address2 = values[2]; 	var city = values[3]; 	var state = values[4]; 	var zip = values[5]; 	var county = values[6]; 	var phone = values[7]; 	var email = values[8];  	 	var remaining = ['','','','','','','','','','','']; 	var remainingSearch = [/P-LPC License Number: ?(.*)/,/P-LPC Issue Date: ?(.*)/,/P-LPC Expiration Date: ?(.*)/,/LPC License Number: ?(.*)/,/LPC Issue Date: ?(.*)/,/LPC Renewal Date: ?(.*)/,/Status: ?(.*)/,/Board Qualified Supervisor (LPC-S): ?(.*)/,/BQS Certification Date: ?(.*)/,/BQS Certification Number: ?(.*)/,/Distance Credentialed Counselor\/Board Certified-TeleMental Health \(BC-TMH\): ?(.*)/]; 	 	for (k=0;k<remaining.length;k++){ 		for (l=0;l<values.length-1;l++){ 			if (values[l].match(remainingSearch[k])){ 				remaining[k]=values[l].match(remainingSearch[k])[1]; 			} 		} 	} 	var plpc_license_number=remaining[0]; 	var plpc_issue_date=remaining[1]; 	var plpc_expiration_date=remaining[2]; 	var lpc_license_number=remaining[3]; 	var lpc_issue_date=remaining[4]; 	var lpc_renewal_date=remaining[5]; 	var license_status=remaining[6]; 	var supervisor=remaining[7]; 	var bqs_cert_date=remaining[8]; 	var bqs_cert_num=remaining[9]; 	var telehealth_cert=remaining[10]; 	 	 	rows[i].insertCell(-1).textContent = full_name; 	rows[i].insertCell(-1).textContent = address1; 	rows[i].insertCell(-1).textContent = address2; 	rows[i].insertCell(-1).textContent = city; 	rows[i].insertCell(-1).textContent = state; 	rows[i].insertCell(-1).textContent = zip; 	rows[i].insertCell(-1).textContent = county; 	rows[i].insertCell(-1).textContent = phone; 	rows[i].insertCell(-1).textContent = email; 	rows[i].insertCell(-1).textContent = plpc_license_number; 	rows[i].insertCell(-1).textContent = plpc_issue_date; 	rows[i].insertCell(-1).textContent = plpc_expiration_date;	 	rows[i].insertCell(-1).textContent = lpc_license_number; 	rows[i].insertCell(-1).textContent = lpc_issue_date; 	rows[i].insertCell(-1).textContent = lpc_renewal_date; 	rows[i].insertCell(-1).textContent = license_status; 	rows[i].insertCell(-1).textContent = supervisor; 	rows[i].insertCell(-1).textContent = bqs_cert_date; 	rows[i].insertCell(-1).textContent = bqs_cert_num; 	rows[i].insertCell(-1).textContent = telehealth_cert; };
}